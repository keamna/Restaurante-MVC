@model IEnumerable<Orden>
@{
}

<div style="width: 100%; class="mt-2">
    <a href="/Identity/Account/Manage" class="btn btn-secondary my-2">Atrás</a>
    <h5>Mis Ordenes</h5>

    @if (Model != null && Model.Count()>0)
    {
        <table class="table table-striped">
            <tr>
                <th>Fecha Orden</th>
                <th>Estado Orden</th>
            </tr>
            @foreach (var order in Model)
            {
                <tr>
                    <td>@order.FechaOrden.ToString("dd-MM-yyyy")</td>
                    <td>@order.OrdenEstado.EstadoNombre</td>
  
                </tr>
                @if (order.DetalleOrden != null && order.DetalleOrden.Count > 0)
                {

                
                <tr>
                    <td>
                        <table class="table table-striped">
                                <tr>
                                    <td>
                                        Total:
                                    </td>
                                    <td>
                                        @(
                                                                    (order.DetalleOrden.Select(item => item.Platillo.Precio * item.Cantidad).Sum())
                                                                    .ToString("C2", System.Globalization.CultureInfo.GetCultureInfo("es-CR"))
                                                                    )
                                </td>
                            </tr>
                            <tr>
                                <th>Platillo</th>
                                <th>Imagen</th>
                                <th>Categoria</th>
                                <th>Precio unitario</th>
                                <th>Cantidad</th>
                                <th>Monto Total</th>
                            </tr>
                            @foreach (var item in order.DetalleOrden)
                            {
                                
                                <tr>
                                    <td>@item.Platillo.PlatilloName</td>
                                    <td>
                                        <img src="@(!string.IsNullOrEmpty(item.Platillo.ImagenUrl) ? $"/img/{item.Platillo.ImagenUrl}" : "/img/noImage.jpeg")"
                                             style="width:80px; height:100px" />
                                    </td>
                                    <td>@item.Platillo.Categoria?.CategoriaName</td>
                                    <td>@item.Platillo.Precio.ToString("C2", System.Globalization.CultureInfo.GetCultureInfo("es-CR"))</td>
                                    <td>@item.Cantidad</td>
                                    <td>@((item.Platillo.Precio * item.Cantidad).ToString("C2", System.Globalization.CultureInfo.GetCultureInfo("es-CR")))</td>
                                </tr>

                            }
                        </table>
                    </td>
                </tr>
                }

            }
        </table>




        }
    else
    {
        <h5>Carrito Vacío</h5>
    }
</div>
